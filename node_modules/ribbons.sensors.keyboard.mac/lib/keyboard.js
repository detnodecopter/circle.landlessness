var Sensor = require('ribbons.sensor');

function Keyboard (options) {
  Sensor.call(this);

  options = options || {}
  this.exitOnCtrlC = options.exitOnCtrlC || true;
  this.encoding = options.encoding || 'utf8';

  setupEmitters.call(this);
}
Sensor.as(Keyboard);

function setupEmitters () {
  process.stdin.setEncoding( this.encoding);
  process.stdin.setRawMode( true );
  
  var self = this;
  process.stdin.on( 'data', function( key ){
    if ( key === '\u0003' ) {
      self.info('ctrl+c');
      if (self.exitOnCtrlC) {
        process.exit();
      } else {
        self.emit('exit', key);        
      }
    } else {
      self.info('stroke:', key);
      self.emit('stroke', key);
    }
    self.lastKey = key;
  });
}

Keyboard.prototype.start = function() {
  process.stdin.resume();
};

Keyboard.prototype.stop = function() {
  process.stdin.pause();
};

module.exports = Keyboard;
